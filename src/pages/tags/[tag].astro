---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import BlogPostItem from "../../components/BlogPostItem.astro";
import BlogTag from "../../components/BlogTag.astro";

export async function getStaticPaths() {
  const allPosts = await getCollection("posts");
  const uniqueTags = [...new Set(allPosts.map((post) => post.data.tags).flat())];

  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) =>
      post.data.tags.includes(tag)
    );
    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout pgTitle={tag}>
    <div class="w-full h-full flex my-10 px-6">
        <div class="w-9/12 mx-4 px-4">
            { posts.map((post) => <BlogPostItem post = {post} />) }
        </div>
        <div class="w-1/4 mx-4 px-4 border-solid border-black border-l-2 flex flex-wrap">
            <BlogTag tag = {tag}/>
        </div>
    </div>
</BaseLayout>